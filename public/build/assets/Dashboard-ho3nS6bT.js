import{r as x,e as S,j as n,H as U}from"./app-DbuBt-SL.js";const C=6e4,k=36e5,I=Symbol.for("constructDateFrom");function v(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&I in e?e[I](t):e instanceof Date?new e.constructor(t):new Date(t)}function j(e,t){return v(e,e)}function A(e){return t=>{const r=(e?Math[e]:Math.trunc)(t);return r===0?0:r}}function L(e,t){return+j(e)-+j(t)}function z(e,t,a){const r=L(e,t)/C;return A(a==null?void 0:a.roundingMethod)(r)}function R(e,t){const a=()=>v(t==null?void 0:t.in,NaN),s=Z(e);let i;if(s.date){const d=_(s.date,2);i=W(d.restDateString,d.year)}if(!i||isNaN(+i))return a();const f=+i;let m=0,l;if(s.time&&(m=V(s.time),isNaN(m)))return a();if(s.timezone){if(l=q(s.timezone),isNaN(l))return a()}else{const d=new Date(f+m),g=j(0);return g.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),g.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),g}return j(f+m+l)}const b={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},P=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Y=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,H=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Z(e){const t={},a=e.split(b.dateTimeDelimiter);let r;if(a.length>2)return t;if(/:/.test(a[0])?r=a[0]:(t.date=a[0],r=a[1],b.timeZoneDelimiter.test(t.date)&&(t.date=e.split(b.timeZoneDelimiter)[0],r=e.substr(t.date.length,e.length))),r){const s=b.timezone.exec(r);s?(t.time=r.replace(s[1],""),t.timezone=s[1]):t.time=r}return t}function _(e,t){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=e.match(a);if(!r)return{year:NaN,restDateString:""};const s=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?s:i*100,restDateString:e.slice((r[1]||r[2]).length)}}function W(e,t){if(t===null)return new Date(NaN);const a=e.match(P);if(!a)return new Date(NaN);const r=!!a[4],s=N(a[1]),i=N(a[2])-1,f=N(a[3]),m=N(a[4]),l=N(a[5])-1;if(r)return K(t,m,l)?B(t,m,l):new Date(NaN);{const d=new Date(0);return!J(t,i,f)||!X(t,s)?new Date(NaN):(d.setUTCFullYear(t,i,Math.max(s,f)),d)}}function N(e){return e?parseInt(e):1}function V(e){const t=e.match(Y);if(!t)return NaN;const a=T(t[1]),r=T(t[2]),s=T(t[3]);return Q(a,r,s)?a*k+r*C+s*1e3:NaN}function T(e){return e&&parseFloat(e.replace(",","."))||0}function q(e){if(e==="Z")return 0;const t=e.match(H);if(!t)return 0;const a=t[1]==="+"?-1:1,r=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return ee(r,s)?a*(r*k+s*C):NaN}function B(e,t,a){const r=new Date(0);r.setUTCFullYear(e,0,4);const s=r.getUTCDay()||7,i=(t-1)*7+a+1-s;return r.setUTCDate(r.getUTCDate()+i),r}const G=[31,null,31,30,31,30,31,31,30,31,30,31];function F(e){return e%400===0||e%4===0&&e%100!==0}function J(e,t,a){return t>=0&&t<=11&&a>=1&&a<=(G[t]||(F(e)?29:28))}function X(e,t){return t>=1&&t<=(F(e)?366:365)}function K(e,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function Q(e,t,a){return e===24?t===0&&a===0:a>=0&&a<60&&t>=0&&t<60&&e>=0&&e<25}function ee(e,t){return t>=0&&t<=59}const te=`
@keyframes blink {
  50% { opacity: 0.4; }
}
.estado-verde {
  background-color: #e9fcf0ff; 
  color: black;
  transition: all 0.4s ease;
}
.estado-naranja {
  background-color: #f97316;
  animation: blink 1s infinite;
  color: black;
}
.estado-rojo {
  background-color: #dc2626;
  animation: blink 1s infinite;
  color: white;
}
`;if(typeof document<"u"){const e=document.createElement("style");e.innerHTML=te,document.head.appendChild(e)}const y=e=>{if(!e)return"No reportado";try{if(/^\d{2}:\d{2}(:\d{2})?$/.test(e.trim()))return e.trim();const[t,a]=e.split(" "),[r,s,i]=t.split("-");return`${i}/${s}/${r}${a?" "+a:""}`}catch{return e}},ne=e=>{const t="America/Mexico_City";let a;try{a=new Date}catch{a=new Date}const r=e.CitaEntrega?R(e.CitaEntrega):null,s={inicioRuta:"",salidaPlanta:"",citaEntrega:""};let i="";if(r)try{const l=z(r,new Date);l<=120&&l>60?s.citaEntrega="estado-naranja":(l<=60&&l>=0||l<0)&&(s.citaEntrega="estado-rojo")}catch(f){console.error("Error CitaEntrega:",f)}return{colorCelda:s,colorFila:i}};function re(){var E;const[e,t]=x.useState(()=>new Date().toISOString().split("T")[0]),a=new Date().toISOString().split("T")[0],[r,s]=x.useState(a),[i,f]=x.useState(a),[m,l]=x.useState([]),[d,g]=x.useState(null),[D,O]=x.useState(""),[h,M]=x.useState(!1),$=6e4;x.useEffect(()=>{w();const o=setInterval(w,$);return()=>clearInterval(o)},[e,r,i]),x.useEffect(()=>(S.private("monitor-logistico").listen("MovtoUpdated",c=>{l(p=>p.map(u=>u.ODP===c.ODP?{...u,...c}:u))}),()=>S.leave("monitor-logistico")),[]);const w=async()=>{var o;try{let c="/api/monitor/json";r&&i?c+=`?fecha_inicio=${r}&fecha_fin=${i}`:c+=`?fecha=${e||new Date().toISOString().split("T")[0]}`,console.log("Conectando con backend:",c);const p=await fetch(c);if(!p.ok)throw new Error(`Error HTTP ${p.status}`);const u=await p.json();console.log("Datos recibidos:",((o=u==null?void 0:u.data)==null?void 0:o.length)||0,"registros"),l((u==null?void 0:u.data)||[]),g(new Date().toLocaleTimeString("es-MX"))}catch(c){console.error("Error en la conexión o lectura de datos:",c),l([])}};return n.jsxs(n.Fragment,{children:[n.jsx(U,{title:"Almacen"}),n.jsxs("div",{className:"container mx-auto max-w-none p-2",children:[n.jsx("h1",{className:"text-3xl font-bold mb-4 text-center",children:"MONITOR DE ENTREGAS PASTEURIZADORA MAULEC SAPI DE CV"}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4 justify-center",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium",children:"Desde"}),n.jsx("input",{type:"date",value:r,onChange:o=>{s(o.target.value),t("")},className:"border rounded px-2 py-1"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium",children:"Hasta"}),n.jsx("input",{type:"date",value:i,onChange:o=>{f(o.target.value),t("")},className:"border rounded px-2 py-1"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium",children:"Línea de Transporte"}),n.jsx("input",{type:"text",placeholder:"Buscar línea...",value:D,onChange:o=>O(o.target.value),className:"border rounded px-2 py-1"})]}),n.jsx("button",{onClick:w,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Filtrar"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Entregados"}),n.jsxs("button",{onClick:()=>M(!h),className:`relative w-16 h-8 flex items-center rounded-full transition-all duration-300 
                  ${h?"bg-blue-500":"bg-gray-300"}`,children:[n.jsx("span",{className:`absolute w-7 h-7 bg-white rounded-full shadow-md transform transition-transform duration-300 
                  ${h?"translate-x-8":"translate-x-1"}`}),n.jsx("span",{className:`absolute left-2 text-xs font-bold transition-opacity duration-200 
                  ${h?"opacity-0":"opacity-100 text-gray-600"}`,children:"OFF"}),n.jsx("span",{className:`absolute right-2 text-xs font-bold transition-opacity duration-200 
                  ${h?"opacity-100 text-white":"opacity-0"}`,children:"ON"})]})]}),n.jsxs("div",{className:"text-sm text-gray-600 italic",children:["Última actualización: ",d||"---"]}),n.jsxs("form",{method:"POST",action:"/logout",onSubmit:()=>console.log("Cerrando sesión..."),children:[n.jsx("input",{type:"hidden",name:"_token",value:(E=document.querySelector('meta[name="csrf-token"]'))==null?void 0:E.getAttribute("content")}),n.jsx("button",{type:"submit",className:"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition",children:"Cerrar sesión"})]})]}),n.jsx("div",{className:"overflow-x-auto max-h-[85vh] shadow-md border border-gray-300 rounded-md",children:n.jsxs("table",{className:"table-auto w-full text-xs md:text-sm border-collapse",children:[n.jsx("thead",{className:"bg-gray-100 sticky top-0 z-10 shadow-sm",children:n.jsxs("tr",{children:[n.jsx("th",{className:"border px-2 py-2",children:"ODP"}),n.jsx("th",{className:"border px-2 py-1",children:"Destino"}),n.jsx("th",{className:"border px-2 py-2",children:"Cliente"}),n.jsx("th",{className:"border px-2 py-2",children:"Línea Transporte"}),n.jsx("th",{className:"border px-2 py-2",children:"Cita Entrega"}),n.jsx("th",{className:"border px-2 py-2",children:"Salida Planta"}),n.jsx("th",{className:"border px-2 py-2",children:"Inicio Ruta"}),n.jsx("th",{className:"border px-2 py-2",children:"ETA"}),n.jsx("th",{className:"border px-2 py-2",children:"Status"}),n.jsx("th",{className:"border px-2 py-2",children:"Comentarios"})]})}),n.jsx("tbody",{children:m.length>0?m.filter(o=>{var p;const c=((p=o.Status)==null?void 0:p.toLowerCase())||"";return h?c==="entregado":c!=="entregado"&&c!=="cancelado"}).filter(o=>{var c;return D.trim()===""?!0:(c=o.LineaTransporte)==null?void 0:c.toLowerCase().includes(D.toLowerCase())}).map((o,c)=>{const{colorCelda:p,colorFila:u}=ne(o);return n.jsxs("tr",{className:`text-center ${u}`,children:[n.jsx("td",{className:"border px-2 py-1",children:o.ODP||"No reportado"}),n.jsx("td",{className:"border px-2 py-1",children:o.Destino||"No reportado"}),n.jsx("td",{className:"border px-2 py-1",children:o.Cliente||"No reportado"}),n.jsx("td",{className:"border px-2 py-1",children:o.LineaTransporte||"No reportado"}),n.jsx("td",{className:`border px-2 py-1 ${p.citaEntrega}`,children:y(o.CitaEntrega)}),n.jsx("td",{className:"border px-2 py-1",children:y(o.SalidaPlanta)}),n.jsx("td",{className:"border px-2 py-1",children:y(o.InicioRuta)}),n.jsx("td",{className:"border px-2 py-1",children:y(o.ETA)}),n.jsx("td",{className:"border px-2 py-1",children:o.Status||"No reportado"}),n.jsx("td",{className:"border px-2 py-1",children:o.ComentarioTransito||"No reportado"})]},c)}):n.jsx("tr",{children:n.jsx("td",{colSpan:"11",className:"text-center py-3 text-gray-500",children:"No hay registros para la fecha seleccionada o rango"})})})]})})]}),n.jsx("footer",{className:"bg-gray-100 text-center py-4 mt-6 border-t shadow-inner",children:n.jsxs("p",{className:"text-gray-700 text-sm md:text-base tracking-wide",children:["© ",new Date().getFullYear()," Desarrollo y análisis de datos"]})})]})}export{re as default};
