import{r as N,e as I,j as n,H as B}from"./app-B1ndpgWr.js";const A=6e4,$=36e5,k=Symbol.for("constructDateFrom");function F(e,a){return typeof e=="function"?e(a):e&&typeof e=="object"&&k in e?e[k](a):e instanceof Date?new e.constructor(a):new Date(a)}function C(e,a){return F(e,e)}function M(e){return a=>{const r=(e?Math[e]:Math.trunc)(a);return r===0?0:r}}function R(e,a){return+C(e)-+C(a)}function b(e,a,t){const r=R(e,a)/A;return M(t==null?void 0:t.roundingMethod)(r)}function m(e,a){const t=()=>F(a==null?void 0:a.in,NaN),l=P(e);let i;if(l.date){const c=z(l.date,2);i=Y(c.restDateString,c.year)}if(!i||isNaN(+i))return t();const h=+i;let u=0,f;if(l.time&&(u=v(l.time),isNaN(u)))return t();if(l.timezone){if(f=H(l.timezone),isNaN(f))return t()}else{const c=new Date(h+u),D=C(0);return D.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),D.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),D}return C(h+u+f)}const T={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},U=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,E=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,L=/^([+-])(\d{2})(?::?(\d{2}))?$/;function P(e){const a={},t=e.split(T.dateTimeDelimiter);let r;if(t.length>2)return a;if(/:/.test(t[0])?r=t[0]:(a.date=t[0],r=t[1],T.timeZoneDelimiter.test(a.date)&&(a.date=e.split(T.timeZoneDelimiter)[0],r=e.substr(a.date.length,e.length))),r){const l=T.timezone.exec(r);l?(a.time=r.replace(l[1],""),a.timezone=l[1]):a.time=r}return a}function z(e,a){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+a)+"})|(\\d{2}|[+-]\\d{"+(2+a)+"})$)"),r=e.match(t);if(!r)return{year:NaN,restDateString:""};const l=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?l:i*100,restDateString:e.slice((r[1]||r[2]).length)}}function Y(e,a){if(a===null)return new Date(NaN);const t=e.match(U);if(!t)return new Date(NaN);const r=!!t[4],l=j(t[1]),i=j(t[2])-1,h=j(t[3]),u=j(t[4]),f=j(t[5])-1;if(r)return q(a,u,f)?Z(a,u,f):new Date(NaN);{const c=new Date(0);return!W(a,i,h)||!V(a,l)?new Date(NaN):(c.setUTCFullYear(a,i,Math.max(l,h)),c)}}function j(e){return e?parseInt(e):1}function v(e){const a=e.match(E);if(!a)return NaN;const t=w(a[1]),r=w(a[2]),l=w(a[3]);return J(t,r,l)?t*$+r*A+l*1e3:NaN}function w(e){return e&&parseFloat(e.replace(",","."))||0}function H(e){if(e==="Z")return 0;const a=e.match(L);if(!a)return 0;const t=a[1]==="+"?-1:1,r=parseInt(a[2]),l=a[3]&&parseInt(a[3])||0;return X(r,l)?t*(r*$+l*A):NaN}function Z(e,a,t){const r=new Date(0);r.setUTCFullYear(e,0,4);const l=r.getUTCDay()||7,i=(a-1)*7+t+1-l;return r.setUTCDate(r.getUTCDate()+i),r}const _=[31,null,31,30,31,30,31,31,30,31,30,31];function O(e){return e%400===0||e%4===0&&e%100!==0}function W(e,a,t){return a>=0&&a<=11&&t>=1&&t<=(_[a]||(O(e)?29:28))}function V(e,a){return a>=1&&a<=(O(e)?366:365)}function q(e,a,t){return a>=1&&a<=53&&t>=0&&t<=6}function J(e,a,t){return e===24?a===0&&t===0:t>=0&&t<60&&a>=0&&a<60&&e>=0&&e<25}function X(e,a){return a>=0&&a<=59}const G=`
@keyframes blink {
  50% { opacity: 0.4; }
}
.estado-verde {
  background-color: #e9fcf0ff; 
  color: black;
  transition: all 0.4s ease;
}
.estado-naranja {
  background-color: #f97316;
  animation: blink 1s infinite;
  color: black;
}
.estado-rojo {
  background-color: #dc2626;
  animation: blink 1s infinite;
  color: white;
}
`;if(typeof document<"u"){const e=document.createElement("style");e.innerHTML=G,document.head.appendChild(e)}const g=e=>{if(!e)return"No reportado";try{const[a,t]=e.split(" "),[r,l,i]=a.split("-");return`${i}/${l}/${r}${t?" "+t:""}`}catch{return e}},K=e=>{const a="America/Mexico_City";let t;try{t=(void 0)(new Date,a)}catch{t=new Date}const r=e.CitaDelta?m(e.CitaDelta):null,l=e.LlegadaDelta?m(e.LlegadaDelta):null,i=e.SalidaDelta?m(e.SalidaDelta):null,h=e.EntradaBascula?m(e.EntradaBascula):null,u=e.SalidaBascula?m(e.SalidaBascula):null,f=e.LlegadaAnden?m(e.LlegadaAnden):null,c=e.SalidaAnden?m(e.SalidaAnden):null,D=e.SalidaPlanta?m(e.SalidaPlanta):null,S=e.InicioRuta?m(e.InicioRuta):null,o={llegadaDelta:"",salidaDelta:"",entradaBascula:"",salidaBascula:"",llegadaAnden:"",salidaAnden:"",inicioRuta:"",salidaPlanta:""};let y="";if(r&&!l){const s=b(r,t);s<=120&&s>60?o.llegadaDelta="estado-naranja":s<=60&&(o.llegadaDelta="estado-rojo")}else l&&(o.llegadaDelta="estado-verde");if(l&&!i){const s=b(t,l);s>=120&&s<180?o.salidaDelta="estado-naranja":s>=180&&(o.salidaDelta="estado-rojo")}else i&&(o.salidaDelta="estado-verde");if(i&&!h){const s=b(t,i);s>=10&&s<20?o.entradaBascula="estado-naranja":s>=20&&(o.entradaBascula="estado-rojo")}else h&&(o.entradaBascula="estado-verde");if(h&&!u?b(t,h)>=10&&(o.salidaBascula="estado-rojo"):u&&(o.salidaBascula="estado-verde"),f&&!c?b(t,f)>=60&&(o.salidaAnden="estado-rojo"):c&&(o.salidaAnden="estado-verde"),S&&!D){const s=b(S,t);s<=120&&s>60?y="estado-naranja":s<=60&&(y="estado-rojo")}return{colorCelda:o,colorFila:y}};function ee(){var y;const[e,a]=N.useState(()=>new Date().toISOString().split("T")[0]),t=new Date().toISOString().split("T")[0],[r,l]=N.useState(t),[i,h]=N.useState(t),[u,f]=N.useState([]),[c,D]=N.useState(null),S=6e4;N.useEffect(()=>{o();const s=setInterval(o,S);return()=>clearInterval(s)},[e,r,i]),N.useEffect(()=>(I.private("monitor-logistico").listen("MovtoUpdated",x=>{f(d=>d.map(p=>p.ODP===x.ODP?{...p,...x}:p))}),()=>I.leave("monitor-logistico")),[]);const o=async()=>{var s;try{let x="/api/monitor/json";r&&i?x+=`?fecha_inicio=${r}&fecha_fin=${i}`:x+=`?fecha=${e||new Date().toISOString().split("T")[0]}`,console.log("Conectando con backend:",x);const d=await fetch(x);if(!d.ok)throw new Error(`Error HTTP ${d.status}`);const p=await d.json();console.log("Datos recibidos:",((s=p==null?void 0:p.data)==null?void 0:s.length)||0,"registros"),f((p==null?void 0:p.data)||[]),D(new Date().toLocaleTimeString("es-MX"))}catch(x){console.error("Error en la conexión o lectura de datos:",x),f([])}};return n.jsxs(n.Fragment,{children:[n.jsx(B,{title:"Almacen"}),n.jsxs("div",{className:"container mx-auto max-w-none p-2",children:[n.jsx("h1",{className:"text-3xl font-bold mb-4 text-center",children:"MONITOR TRÁFICO PASTEURIZADORA MAULEC SAPI DE CV"}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4 justify-center",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium",children:"Desde"}),n.jsx("input",{type:"date",value:r,onChange:s=>{l(s.target.value),a("")},className:"border rounded px-2 py-1"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium",children:"Hasta"}),n.jsx("input",{type:"date",value:i,onChange:s=>{h(s.target.value),a("")},className:"border rounded px-2 py-1"})]}),n.jsx("button",{onClick:o,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Filtrar"}),n.jsxs("div",{className:"text-sm text-gray-600 italic",children:["Última actualización: ",c||"---"]}),n.jsxs("form",{method:"POST",action:"/logout",onSubmit:()=>console.log("Cerrando sesión..."),children:[n.jsx("input",{type:"hidden",name:"_token",value:(y=document.querySelector('meta[name="csrf-token"]'))==null?void 0:y.getAttribute("content")}),n.jsx("button",{type:"submit",className:"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition",children:"Cerrar sesión"})]})]}),n.jsx("div",{className:"overflow-x-auto max-h-[85vh] shadow-md border border-gray-300 rounded-md",children:n.jsxs("table",{className:"table-auto w-full text-xs md:text-sm border-collapse",children:[n.jsx("thead",{className:"bg-gray-100 sticky top-0 z-10 shadow-sm",children:n.jsxs("tr",{children:[n.jsx("th",{className:"border px-2 py-2",children:"ODP"}),n.jsx("th",{className:"border px-2 py-2",children:"Línea Transporte"}),n.jsx("th",{className:"border px-2 py-2",children:"Cita Delta"}),n.jsx("th",{className:"border px-2 py-2",children:"Llegada Delta"}),n.jsx("th",{className:"border px-2 py-2",children:"Salida Delta"}),n.jsx("th",{className:"border px-2 py-2",children:"Entrada Báscula"}),n.jsx("th",{className:"border px-2 py-2",children:"Salida Báscula"}),n.jsx("th",{className:"border px-2 py-2",children:"No. Andén"}),n.jsx("th",{className:"border px-2 py-2",children:"Llegada Andén"}),n.jsx("th",{className:"border px-2 py-2",children:"Salida Andén"}),n.jsx("th",{className:"border px-2 py-2",children:"Salida Planta"}),n.jsx("th",{className:"border px-2 py-2",children:"Inicio Ruta"})]})}),n.jsx("tbody",{children:u.length>0?u.filter(s=>!s.SalidaPlanta).filter(s=>s.CitaDelta).map((s,x)=>{const{colorCelda:d,colorFila:p}=K(s);return n.jsxs("tr",{className:`text-center ${p}`,children:[n.jsx("td",{className:"border px-2 py-1",children:s.ODP||"No reportado"}),n.jsx("td",{className:"border px-2 py-1",children:s.LineaTransporte||"No reportado"}),n.jsx("td",{className:"border px-2 py-1",children:g(s.CitaDelta)}),n.jsx("td",{className:`border px-2 py-1 ${d.llegadaDelta}`,children:g(s.LlegadaDelta)}),n.jsx("td",{className:`border px-2 py-1 ${d.salidaDelta}`,children:g(s.SalidaDelta)}),n.jsx("td",{className:`border px-2 py-1 ${d.entradaBascula}`,children:g(s.EntradaBascula)}),n.jsx("td",{className:`border px-2 py-1 ${d.salidaBascula}`,children:g(s.SalidaBascula)}),n.jsx("td",{className:"border px-2 py-1",children:s.NoAnden||"No reportado"}),n.jsx("td",{className:`border px-2 py-1 ${d.llegadaAnden}`,children:g(s.LlegadaAnden)}),n.jsx("td",{className:`border px-2 py-1 ${d.salidaAnden}`,children:g(s.SalidaAnden)}),n.jsx("td",{className:`border px-2 py-1 ${d.salidaPlanta}`,children:g(s.SalidaPlanta)}),n.jsx("td",{className:`border px-2 py-1 ${d.inicioRuta}`,children:g(s.InicioRuta)})]},x)}):n.jsx("tr",{children:n.jsx("td",{colSpan:"11",className:"text-center py-3 text-gray-500",children:"No hay registros para la fecha seleccionada o rango"})})})]})})]}),n.jsx("footer",{className:"bg-gray-100 text-center py-4 mt-6 border-t shadow-inner",children:n.jsxs("p",{className:"text-gray-700 text-sm md:text-base tracking-wide",children:["© ",new Date().getFullYear()," Desarrollo y análisis de datos"]})})]})}export{ee as default};
