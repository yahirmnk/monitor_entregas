import{r as h,e as S,j as r,H as A}from"./app-DCI3vtoP.js";const C=6e4,I=36e5,E=Symbol.for("constructDateFrom");function k(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&E in e?e[E](t):e instanceof Date?new e.constructor(t):new Date(t)}function b(e,t){return k(e,e)}function M(e){return t=>{const a=(e?Math[e]:Math.trunc)(t);return a===0?0:a}}function U(e,t){return+b(e)-+b(t)}function z(e,t,n){const a=U(e,t)/C;return M(n==null?void 0:n.roundingMethod)(a)}function L(e,t){const n=()=>k(t==null?void 0:t.in,NaN),s=Y(e);let i;if(s.date){const d=H(s.date,2);i=Z(d.restDateString,d.year)}if(!i||isNaN(+i))return n();const f=+i;let u=0,c;if(s.time&&(u=_(s.time),isNaN(u)))return n();if(s.timezone){if(c=W(s.timezone),isNaN(c))return n()}else{const d=new Date(f+u),x=b(0);return x.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),x.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),x}return b(f+u+c)}const N={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},R=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,$=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,P=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Y(e){const t={},n=e.split(N.dateTimeDelimiter);let a;if(n.length>2)return t;if(/:/.test(n[0])?a=n[0]:(t.date=n[0],a=n[1],N.timeZoneDelimiter.test(t.date)&&(t.date=e.split(N.timeZoneDelimiter)[0],a=e.substr(t.date.length,e.length))),a){const s=N.timezone.exec(a);s?(t.time=a.replace(s[1],""),t.timezone=s[1]):t.time=a}return t}function H(e,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),a=e.match(n);if(!a)return{year:NaN,restDateString:""};const s=a[1]?parseInt(a[1]):null,i=a[2]?parseInt(a[2]):null;return{year:i===null?s:i*100,restDateString:e.slice((a[1]||a[2]).length)}}function Z(e,t){if(t===null)return new Date(NaN);const n=e.match(R);if(!n)return new Date(NaN);const a=!!n[4],s=g(n[1]),i=g(n[2])-1,f=g(n[3]),u=g(n[4]),c=g(n[5])-1;if(a)return J(t,u,c)?V(t,u,c):new Date(NaN);{const d=new Date(0);return!B(t,i,f)||!G(t,s)?new Date(NaN):(d.setUTCFullYear(t,i,Math.max(s,f)),d)}}function g(e){return e?parseInt(e):1}function _(e){const t=e.match($);if(!t)return NaN;const n=T(t[1]),a=T(t[2]),s=T(t[3]);return X(n,a,s)?n*I+a*C+s*1e3:NaN}function T(e){return e&&parseFloat(e.replace(",","."))||0}function W(e){if(e==="Z")return 0;const t=e.match(P);if(!t)return 0;const n=t[1]==="+"?-1:1,a=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return K(a,s)?n*(a*I+s*C):NaN}function V(e,t,n){const a=new Date(0);a.setUTCFullYear(e,0,4);const s=a.getUTCDay()||7,i=(t-1)*7+n+1-s;return a.setUTCDate(a.getUTCDate()+i),a}const q=[31,null,31,30,31,30,31,31,30,31,30,31];function v(e){return e%400===0||e%4===0&&e%100!==0}function B(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(q[t]||(v(e)?29:28))}function G(e,t){return t>=1&&t<=(v(e)?366:365)}function J(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function X(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function K(e,t){return t>=0&&t<=59}const Q=`
@keyframes blink {
  50% { opacity: 0.4; }
}
.estado-verde {
  background-color: #e9fcf0ff; 
  color: black;
  transition: all 0.4s ease;
}
.estado-naranja {
  background-color: #f97316;
  animation: blink 1s infinite;
  color: black;
}
.estado-rojo {
  background-color: #dc2626;
  animation: blink 1s infinite;
  color: white;
}
`;if(typeof document<"u"){const e=document.createElement("style");e.innerHTML=Q,document.head.appendChild(e)}const y=e=>{if(!e)return"No reportado";try{const[t,n]=e.split(" "),[a,s,i]=t.split("-");return`${i}/${s}/${a}${n?" "+n:""}`}catch{return e}},ee=e=>{const t="America/Mexico_City";let n;try{n=new Date}catch{n=new Date}const a=e.CitaEntrega?L(e.CitaEntrega):null,s={inicioRuta:"",salidaPlanta:"",citaEntrega:""};let i="";if(a)try{const f=a,u=new Date,c=z(f,u);console.log("[CITA]","ODP:",e.ODP,"| CitaEntrega:",f,"| Ahora:",u,"| Diff(min):",c),c<=120&&c>60?s.citaEntrega="estado-naranja":(c<=60&&c>=0||c<0)&&(s.citaEntrega="estado-rojo")}catch(f){console.error("Error CitaEntrega:",f)}return{colorCelda:s,colorFila:i}};function ne(){var w;const[e,t]=h.useState(()=>new Date().toISOString().split("T")[0]),n=new Date().toISOString().split("T")[0],[a,s]=h.useState(n),[i,f]=h.useState(n),[u,c]=h.useState([]),[d,x]=h.useState(null),[D,O]=h.useState(""),F=6e4;h.useEffect(()=>{j();const o=setInterval(j,F);return()=>clearInterval(o)},[e,a,i]),h.useEffect(()=>(S.private("monitor-logistico").listen("MovtoUpdated",l=>{c(p=>p.map(m=>m.ODP===l.ODP?{...m,...l}:m))}),()=>S.leave("monitor-logistico")),[]);const j=async()=>{var o;try{let l="/api/monitor/json";a&&i?l+=`?fecha_inicio=${a}&fecha_fin=${i}`:l+=`?fecha=${e||new Date().toISOString().split("T")[0]}`,console.log("Conectando con backend:",l);const p=await fetch(l);if(!p.ok)throw new Error(`Error HTTP ${p.status}`);const m=await p.json();console.log("Datos recibidos:",((o=m==null?void 0:m.data)==null?void 0:o.length)||0,"registros"),c((m==null?void 0:m.data)||[]),x(new Date().toLocaleTimeString("es-MX"))}catch(l){console.error("Error en la conexión o lectura de datos:",l),c([])}};return r.jsxs(r.Fragment,{children:[r.jsx(A,{title:"Almacen"}),r.jsxs("div",{className:"container mx-auto max-w-none p-2",children:[r.jsx("h1",{className:"text-3xl font-bold mb-4 text-center",children:"MONITOR DE ENTREGAS PASTEURIZADORA MAULEC SAPI DE CV"}),r.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4 justify-center",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Desde"}),r.jsx("input",{type:"date",value:a,onChange:o=>{s(o.target.value),t("")},className:"border rounded px-2 py-1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Hasta"}),r.jsx("input",{type:"date",value:i,onChange:o=>{f(o.target.value),t("")},className:"border rounded px-2 py-1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Línea de Transporte"}),r.jsx("input",{type:"text",placeholder:"Buscar línea...",value:D,onChange:o=>O(o.target.value),className:"border rounded px-2 py-1"})]}),r.jsx("button",{onClick:j,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Filtrar"}),r.jsxs("div",{className:"text-sm text-gray-600 italic",children:["Última actualización: ",d||"---"]}),r.jsxs("form",{method:"POST",action:"/logout",onSubmit:()=>console.log("Cerrando sesión..."),children:[r.jsx("input",{type:"hidden",name:"_token",value:(w=document.querySelector('meta[name="csrf-token"]'))==null?void 0:w.getAttribute("content")}),r.jsx("button",{type:"submit",className:"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition",children:"Cerrar sesión"})]})]}),r.jsx("div",{className:"overflow-x-auto max-h-[85vh] shadow-md border border-gray-300 rounded-md",children:r.jsxs("table",{className:"table-auto w-full text-xs md:text-sm border-collapse",children:[r.jsx("thead",{className:"bg-gray-100 sticky top-0 z-10 shadow-sm",children:r.jsxs("tr",{children:[r.jsx("th",{className:"border px-2 py-2",children:"ODP"}),r.jsx("th",{className:"border px-2 py-2",children:"Línea Transporte"}),r.jsx("th",{className:"border px-2 py-2",children:"Cita Entrega"}),r.jsx("th",{className:"border px-2 py-2",children:"Salida Planta"}),r.jsx("th",{className:"border px-2 py-2",children:"Inicio Ruta"}),r.jsx("th",{className:"border px-2 py-2",children:"ETA"}),r.jsx("th",{className:"border px-2 py-2",children:"Status"}),r.jsx("th",{className:"border px-2 py-2",children:"Comentarios"})]})}),r.jsx("tbody",{children:u.length>0?u.filter(o=>{var l;return((l=o.Status)==null?void 0:l.toLowerCase())!=="entregado"}).filter(o=>{var l;return D.trim()===""?!0:(l=o.LineaTransporte)==null?void 0:l.toLowerCase().includes(D.toLowerCase())}).map((o,l)=>{const{colorCelda:p,colorFila:m}=ee(o);return r.jsxs("tr",{className:`text-center ${m}`,children:[r.jsx("td",{className:"border px-2 py-1",children:o.ODP||"No reportado"}),r.jsx("td",{className:"border px-2 py-1",children:o.LineaTransporte||"No reportado"}),r.jsx("td",{className:`border px-2 py-1 ${p.citaEntrega}`,children:y(o.CitaEntrega)}),r.jsx("td",{className:"border px-2 py-1",children:y(o.SalidaPlanta)}),r.jsx("td",{className:"border px-2 py-1",children:y(o.InicioRuta)}),r.jsx("td",{className:"border px-2 py-1",children:y(o.ETA)}),r.jsx("td",{className:"border px-2 py-1",children:o.Status||"No reportado"}),r.jsx("td",{className:"border px-2 py-1",children:o.ComentarioTransito||"No reportado"})]},l)}):r.jsx("tr",{children:r.jsx("td",{colSpan:"11",className:"text-center py-3 text-gray-500",children:"No hay registros para la fecha seleccionada o rango"})})})]})})]}),r.jsx("footer",{className:"bg-gray-100 text-center py-4 mt-6 border-t shadow-inner",children:r.jsxs("p",{className:"text-gray-700 text-sm md:text-base tracking-wide",children:["© ",new Date().getFullYear()," Desarrollo y análisis de datos"]})})]})}export{ne as default};
