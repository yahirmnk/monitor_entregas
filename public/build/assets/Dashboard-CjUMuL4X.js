import{r as x,j as s,H as I}from"./app-CgeD93GW.js";const N=6e4,y=36e5,j=Symbol.for("constructDateFrom");function b(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&j in e?e[j](t):e instanceof Date?new e.constructor(t):new Date(t)}function h(e,t){return b(e,e)}function S(e,...t){const a=b.bind(null,t.find(n=>typeof n=="object"));return t.map(a)}function w(e){return t=>{const n=(e?Math[e]:Math.trunc)(t);return n===0?0:n}}function k(e,t,a){const[n,c]=S(a==null?void 0:a.in,e,t),i=(+n-+c)/y;return w(a==null?void 0:a.roundingMethod)(i)}function A(e,t){return+h(e)-+h(t)}function T(e,t,a){const n=A(e,t)/N;return w(a==null?void 0:a.roundingMethod)(n)}function L(e,t){return+h(e)>+h(t)}function m(e,t){const a=()=>b(t==null?void 0:t.in,NaN),c=M(e);let i;if(c.date){const o=z(c.date,2);i=R(o.restDateString,o.year)}if(!i||isNaN(+i))return a();const d=+i;let l=0,r;if(c.time&&(l=$(c.time),isNaN(l)))return a();if(c.timezone){if(r=O(c.timezone),isNaN(r))return a()}else{const o=new Date(d+l),u=h(0);return u.setFullYear(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),u.setHours(o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds()),u}return h(d+l+r)}const g={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},U=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,E=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,F=/^([+-])(\d{2})(?::?(\d{2}))?$/;function M(e){const t={},a=e.split(g.dateTimeDelimiter);let n;if(a.length>2)return t;if(/:/.test(a[0])?n=a[0]:(t.date=a[0],n=a[1],g.timeZoneDelimiter.test(t.date)&&(t.date=e.split(g.timeZoneDelimiter)[0],n=e.substr(t.date.length,e.length))),n){const c=g.timezone.exec(n);c?(t.time=n.replace(c[1],""),t.timezone=c[1]):t.time=n}return t}function z(e,t){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(a);if(!n)return{year:NaN,restDateString:""};const c=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?c:i*100,restDateString:e.slice((n[1]||n[2]).length)}}function R(e,t){if(t===null)return new Date(NaN);const a=e.match(U);if(!a)return new Date(NaN);const n=!!a[4],c=p(a[1]),i=p(a[2])-1,d=p(a[3]),l=p(a[4]),r=p(a[5])-1;if(n)return _(t,l,r)?H(t,l,r):new Date(NaN);{const o=new Date(0);return!Z(t,i,d)||!P(t,c)?new Date(NaN):(o.setUTCFullYear(t,i,Math.max(c,d)),o)}}function p(e){return e?parseInt(e):1}function $(e){const t=e.match(E);if(!t)return NaN;const a=D(t[1]),n=D(t[2]),c=D(t[3]);return B(a,n,c)?a*y+n*N+c*1e3:NaN}function D(e){return e&&parseFloat(e.replace(",","."))||0}function O(e){if(e==="Z")return 0;const t=e.match(F);if(!t)return 0;const a=t[1]==="+"?-1:1,n=parseInt(t[2]),c=t[3]&&parseInt(t[3])||0;return W(n,c)?a*(n*y+c*N):NaN}function H(e,t,a){const n=new Date(0);n.setUTCFullYear(e,0,4);const c=n.getUTCDay()||7,i=(t-1)*7+a+1-c;return n.setUTCDate(n.getUTCDate()+i),n}const Y=[31,null,31,30,31,30,31,31,30,31,30,31];function C(e){return e%400===0||e%4===0&&e%100!==0}function Z(e,t,a){return t>=0&&t<=11&&a>=1&&a<=(Y[t]||(C(e)?29:28))}function P(e,t){return t>=1&&t<=(C(e)?366:365)}function _(e,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function B(e,t,a){return e===24?t===0&&a===0:a>=0&&a<60&&t>=0&&t<60&&e>=0&&e<25}function W(e,t){return t>=0&&t<=59}const v=`
@keyframes blink {
  50% { opacity: 0.4; }
}
.estado-verde {
  background-color: #16a34a; /* green-600 */
  color: white;
  transition: all 0.4s ease;
}
.estado-naranja {
  background-color: #f97316; /* orange-500 */
  animation: blink 1s infinite;
  color: black;
}
.estado-rojo {
  background-color: #dc2626; /* red-600 */
  animation: blink 1s infinite;
  color: white;
}
.fila-roja td:not(:empty) {
  background-color: #dc2626;
  color: white;
  animation: blink 1s infinite;
}
`;if(typeof document<"u"){const e=document.createElement("style");e.innerHTML=v,document.head.appendChild(e)}const f=e=>{if(!e)return"-";try{const[t,a]=e.split(" "),[n,c,i]=t.split("-");return`${i}/${c}/${n}${a?" "+a:""}`}catch{return e}},J=e=>{const t=new Date,a=e.CitaDelta?m(e.CitaDelta):null,n=e.LlegadaDelta?m(e.LlegadaDelta):null,c=e.EntradaBascula?m(e.EntradaBascula):null,i=e.LlegadaAnden?m(e.LlegadaAnden):null,d=e.SalidaDelta?m(e.SalidaDelta):null,l=e.InicioRuta?m(e.InicioRuta):null;let r="";if(a&&n){const o=T(n,a);o<=0?r="estado-verde":o>120&&r===""?r="estado-rojo":o>60&&r===""&&(r="estado-naranja")}if((r===""||r==="estado-naranja")&&c&&!i&&(T(t,c)>=20&&r!=="estado-verde"?r="estado-rojo":r===""&&(r="estado-naranja")),d&&l){const o=k(l,d);if(o<=1)return"fila-roja";o<=2&&r===""?r="estado-naranja":L(l,d)&&r===""&&(r="estado-verde")}return r};function q(){const[e,t]=x.useState(()=>new Date().toISOString().split("T")[0]),[a,n]=x.useState([]),[c,i]=x.useState(null),d=3e5;x.useEffect(()=>{console.log("Componente montado. Fecha seleccionada:",e),l(e);const r=setInterval(()=>{console.log("Ejecutando actualización automática..."),l(e)},d);return()=>{console.log("Componente desmontado o fecha cambiada, limpiando intervalo."),clearInterval(r)}},[e]);const l=async r=>{try{console.log("Solicitando datos del backend para la fecha:",r);const o=await fetch(`/api/monitor/json?fecha=${r}`);if(!o.ok)throw console.error("Error HTTP en la respuesta:",o.status),new Error(`Error HTTP ${o.status}`);const u=await o.json();u&&Array.isArray(u.data)?(console.log("Datos recibidos:",u.data.length,"registros"),n(u.data)):(console.warn("Formato inesperado de respuesta:",u),n([])),i(new Date().toLocaleTimeString()),console.log("Actualización completada correctamente:",new Date().toLocaleTimeString())}catch(o){console.error("Error al refrescar datos:",o),n([])}};return s.jsxs(s.Fragment,{children:[s.jsx(I,{title:"Dashboard Logístico"}),s.jsxs("div",{className:"container mx-auto p-4",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Dashboard Logístico"}),s.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium",children:"Fecha"}),s.jsx("input",{type:"date",value:e,onChange:r=>{console.log("Fecha seleccionada manualmente:",r.target.value),t(r.target.value)},className:"border rounded px-2 py-1"})]}),s.jsxs("div",{className:"text-sm text-gray-600 italic",children:["Última actualización: ",c||"---"]})]}),s.jsxs("table",{className:"min-w-full border border-gray-300 text-sm",children:[s.jsx("thead",{className:"bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"border px-2 py-1",children:"ODP"}),s.jsx("th",{className:"border px-2 py-1",children:"Cita Delta"}),s.jsx("th",{className:"border px-2 py-1",children:"Llegada Delta"}),s.jsx("th",{className:"border px-2 py-1",children:"Salida Delta"}),s.jsx("th",{className:"border px-2 py-1",children:"Entrada Báscula"}),s.jsx("th",{className:"border px-2 py-1",children:"No. Andén"}),s.jsx("th",{className:"border px-2 py-1",children:"Llegada Andén"}),s.jsx("th",{className:"border px-2 py-1",children:"Salida Planta"}),s.jsx("th",{className:"border px-2 py-1",children:"Inicio Ruta"})]})}),s.jsx("tbody",{children:a.length>0?a.map((r,o)=>{const u=J(r);return s.jsxs("tr",{className:`text-center ${u}`,children:[s.jsx("td",{className:"border px-2 py-1",children:r.ODP||"-"}),s.jsx("td",{className:"border px-2 py-1",children:f(r.CitaDelta)}),s.jsx("td",{className:"border px-2 py-1",children:f(r.LlegadaDelta)}),s.jsx("td",{className:"border px-2 py-1",children:f(r.SalidaDelta)}),s.jsx("td",{className:"border px-2 py-1",children:f(r.EntradaBascula)}),s.jsx("td",{className:"border px-2 py-1",children:r.NoAnden||"-"}),s.jsx("td",{className:"border px-2 py-1",children:f(r.LlegadaAnden)}),s.jsx("td",{className:"border px-2 py-1",children:f(r.SalidaPlanta)}),s.jsx("td",{className:"border px-2 py-1",children:f(r.InicioRuta)})]},o)}):s.jsx("tr",{children:s.jsx("td",{colSpan:"9",className:"text-center py-3 text-gray-500",children:"No hay registros para la fecha seleccionada"})})})]})]})]})}export{q as default};
