import{r as p,e as S,j as r,H as F}from"./app-OXn4cKAU.js";const C=6e4,I=36e5,E=Symbol.for("constructDateFrom");function k(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&E in e?e[E](t):e instanceof Date?new e.constructor(t):new Date(t)}function b(e,t){return k(e,e)}function M(e){return t=>{const a=(e?Math[e]:Math.trunc)(t);return a===0?0:a}}function U(e,t){return+b(e)-+b(t)}function R(e,t,n){const a=U(e,t)/C;return M(n==null?void 0:n.roundingMethod)(a)}function j(e,t){const n=()=>k(t==null?void 0:t.in,NaN),s=$(e);let i;if(s.date){const l=L(s.date,2);i=Y(l.restDateString,l.year)}if(!i||isNaN(+i))return n();const f=+i;let u=0,c;if(s.time&&(u=H(s.time),isNaN(u)))return n();if(s.timezone){if(c=Z(s.timezone),isNaN(c))return n()}else{const l=new Date(f+u),x=b(0);return x.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),x.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),x}return b(f+u+c)}const N={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},v=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,z=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,P=/^([+-])(\d{2})(?::?(\d{2}))?$/;function $(e){const t={},n=e.split(N.dateTimeDelimiter);let a;if(n.length>2)return t;if(/:/.test(n[0])?a=n[0]:(t.date=n[0],a=n[1],N.timeZoneDelimiter.test(t.date)&&(t.date=e.split(N.timeZoneDelimiter)[0],a=e.substr(t.date.length,e.length))),a){const s=N.timezone.exec(a);s?(t.time=a.replace(s[1],""),t.timezone=s[1]):t.time=a}return t}function L(e,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),a=e.match(n);if(!a)return{year:NaN,restDateString:""};const s=a[1]?parseInt(a[1]):null,i=a[2]?parseInt(a[2]):null;return{year:i===null?s:i*100,restDateString:e.slice((a[1]||a[2]).length)}}function Y(e,t){if(t===null)return new Date(NaN);const n=e.match(v);if(!n)return new Date(NaN);const a=!!n[4],s=g(n[1]),i=g(n[2])-1,f=g(n[3]),u=g(n[4]),c=g(n[5])-1;if(a)return G(t,u,c)?_(t,u,c):new Date(NaN);{const l=new Date(0);return!V(t,i,f)||!q(t,s)?new Date(NaN):(l.setUTCFullYear(t,i,Math.max(s,f)),l)}}function g(e){return e?parseInt(e):1}function H(e){const t=e.match(z);if(!t)return NaN;const n=T(t[1]),a=T(t[2]),s=T(t[3]);return J(n,a,s)?n*I+a*C+s*1e3:NaN}function T(e){return e&&parseFloat(e.replace(",","."))||0}function Z(e){if(e==="Z")return 0;const t=e.match(P);if(!t)return 0;const n=t[1]==="+"?-1:1,a=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return X(a,s)?n*(a*I+s*C):NaN}function _(e,t,n){const a=new Date(0);a.setUTCFullYear(e,0,4);const s=a.getUTCDay()||7,i=(t-1)*7+n+1-s;return a.setUTCDate(a.getUTCDate()+i),a}const W=[31,null,31,30,31,30,31,31,30,31,30,31];function O(e){return e%400===0||e%4===0&&e%100!==0}function V(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(W[t]||(O(e)?29:28))}function q(e,t){return t>=1&&t<=(O(e)?366:365)}function G(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function J(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function X(e,t){return t>=0&&t<=59}const B=`
@keyframes blink {
  50% { opacity: 0.4; }
}
.estado-verde {
  background-color: #e9fcf0ff; 
  color: black;
  transition: all 0.4s ease;
}
.estado-naranja {
  background-color: #f97316;
  animation: blink 1s infinite;
  color: black;
}
.estado-rojo {
  background-color: #dc2626;
  animation: blink 1s infinite;
  color: white;
}
`;if(typeof document<"u"){const e=document.createElement("style");e.innerHTML=B,document.head.appendChild(e)}const y=e=>{if(!e)return"No reportado";try{const[t,n]=e.split(" "),[a,s,i]=t.split("-");return`${i}/${s}/${a}${n?" "+n:""}`}catch{return e}},K=e=>{const t="America/Mexico_City";let n;try{n=new Date}catch{n=new Date}e.SalidaPlanta&&j(e.SalidaPlanta),e.InicioRuta&&j(e.InicioRuta);const a=e.CitaEntrega?j(e.CitaEntrega):null,s={inicioRuta:"",salidaPlanta:"",citaEntrega:""};let i="";if(a)try{const f=a,u=new Date,c=R(f,u);console.log("[CITA]","ODP:",e.ODP,"| CitaEntrega:",f,"| Ahora:",u,"| Diff(min):",c),c<=120&&c>60?s.citaEntrega="estado-naranja":(c<=60&&c>=0||c<0)&&(s.citaEntrega="estado-rojo")}catch(f){console.error("Error CitaEntrega:",f)}return{colorCelda:s,colorFila:i}};function ee(){var w;const[e,t]=p.useState(()=>new Date().toISOString().split("T")[0]),n=new Date().toISOString().split("T")[0],[a,s]=p.useState(n),[i,f]=p.useState(n),[u,c]=p.useState([]),[l,x]=p.useState(null),A=6e4;p.useEffect(()=>{D();const o=setInterval(D,A);return()=>clearInterval(o)},[e,a,i]),p.useEffect(()=>(S.private("monitor-logistico").listen("MovtoUpdated",d=>{c(h=>h.map(m=>m.ODP===d.ODP?{...m,...d}:m))}),()=>S.leave("monitor-logistico")),[]);const D=async()=>{var o;try{let d="/api/monitor/json";a&&i?d+=`?fecha_inicio=${a}&fecha_fin=${i}`:d+=`?fecha=${e||new Date().toISOString().split("T")[0]}`,console.log("Conectando con backend:",d);const h=await fetch(d);if(!h.ok)throw new Error(`Error HTTP ${h.status}`);const m=await h.json();console.log("Datos recibidos:",((o=m==null?void 0:m.data)==null?void 0:o.length)||0,"registros"),c((m==null?void 0:m.data)||[]),x(new Date().toLocaleTimeString("es-MX"))}catch(d){console.error("Error en la conexión o lectura de datos:",d),c([])}};return r.jsxs(r.Fragment,{children:[r.jsx(F,{title:"Almacen"}),r.jsxs("div",{className:"container mx-auto max-w-none p-2",children:[r.jsx("h1",{className:"text-3xl font-bold mb-4 text-center",children:"MONITOR DE ENTREGAS PASTEURIZADORA MAULEC SAPI DE CV"}),r.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4 justify-center",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Desde"}),r.jsx("input",{type:"date",value:a,onChange:o=>{s(o.target.value),t("")},className:"border rounded px-2 py-1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Hasta"}),r.jsx("input",{type:"date",value:i,onChange:o=>{f(o.target.value),t("")},className:"border rounded px-2 py-1"})]}),r.jsx("button",{onClick:D,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Filtrar"}),r.jsxs("div",{className:"text-sm text-gray-600 italic",children:["Última actualización: ",l||"---"]}),r.jsxs("form",{method:"POST",action:"/logout",onSubmit:()=>console.log("Cerrando sesión..."),children:[r.jsx("input",{type:"hidden",name:"_token",value:(w=document.querySelector('meta[name="csrf-token"]'))==null?void 0:w.getAttribute("content")}),r.jsx("button",{type:"submit",className:"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition",children:"Cerrar sesión"})]})]}),r.jsx("div",{className:"overflow-x-auto max-h-[85vh] shadow-md border border-gray-300 rounded-md",children:r.jsxs("table",{className:"table-auto w-full text-xs md:text-sm border-collapse",children:[r.jsx("thead",{className:"bg-gray-100 sticky top-0 z-10 shadow-sm",children:r.jsxs("tr",{children:[r.jsx("th",{className:"border px-2 py-2",children:"ODP"}),r.jsx("th",{className:"border px-2 py-2",children:"Línea Transporte"}),r.jsx("th",{className:"border px-2 py-2",children:"Cita Entrega"}),r.jsx("th",{className:"border px-2 py-2",children:"Salida Planta"}),r.jsx("th",{className:"border px-2 py-2",children:"Inicio Ruta"}),r.jsx("th",{className:"border px-2 py-2",children:"ETA"}),r.jsx("th",{className:"border px-2 py-2",children:"Status"}),r.jsx("th",{className:"border px-2 py-2",children:"Comentarios"})]})}),r.jsx("tbody",{children:u.length>0?u.filter(o=>{var d;return((d=o.Status)==null?void 0:d.toLowerCase())!=="entregado"}).map((o,d)=>{const{colorCelda:h,colorFila:m}=K(o);return r.jsxs("tr",{className:`text-center ${m}`,children:[r.jsx("td",{className:"border px-2 py-1",children:o.ODP||"No reportado"}),r.jsx("td",{className:"border px-2 py-1",children:o.LineaTransporte||"No reportado"}),r.jsx("td",{className:`border px-2 py-1 ${h.citaEntrega}`,children:y(o.CitaEntrega)}),r.jsx("td",{className:"border px-2 py-1",children:y(o.SalidaPlanta)}),r.jsx("td",{className:"border px-2 py-1",children:y(o.InicioRuta)}),r.jsx("td",{className:"border px-2 py-1",children:y(o.ETA)}),r.jsx("td",{className:"border px-2 py-1",children:o.Status||"No reportado"}),r.jsx("td",{className:"border px-2 py-1",children:o.ComentarioTransito||"No reportado"})]},d)}):r.jsx("tr",{children:r.jsx("td",{colSpan:"11",className:"text-center py-3 text-gray-500",children:"No hay registros para la fecha seleccionada o rango"})})})]})})]}),r.jsx("footer",{className:"bg-gray-100 text-center py-4 mt-6 border-t shadow-inner",children:r.jsxs("p",{className:"text-gray-700 text-sm md:text-base tracking-wide",children:["© ",new Date().getFullYear()," Desarrollo y análisis de datos"]})})]})}export{ee as default};
