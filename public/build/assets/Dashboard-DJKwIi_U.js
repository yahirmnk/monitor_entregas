import{r as x,e as T,j as n,H as O}from"./app-BrW6j3jY.js";const I=6e4,k=36e5,C=Symbol.for("constructDateFrom");function A(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&C in e?e[C](t):e instanceof Date?new e.constructor(t):new Date(t)}function w(e,t){return A(e,e)}function h(e,t){const a=()=>A(t==null?void 0:t.in,NaN),s=L(e);let o;if(s.date){const l=M(s.date,2);o=P(l.restDateString,l.year)}if(!o||isNaN(+o))return a();const f=+o;let d=0,u;if(s.time&&(d=z(s.time),isNaN(d)))return a();if(s.timezone){if(u=Y(s.timezone),isNaN(u))return a()}else{const l=new Date(f+d),g=w(0);return g.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),g.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),g}return w(f+d+u)}const y={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},U=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,R=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,$=/^([+-])(\d{2})(?::?(\d{2}))?$/;function L(e){const t={},a=e.split(y.dateTimeDelimiter);let r;if(a.length>2)return t;if(/:/.test(a[0])?r=a[0]:(t.date=a[0],r=a[1],y.timeZoneDelimiter.test(t.date)&&(t.date=e.split(y.timeZoneDelimiter)[0],r=e.substr(t.date.length,e.length))),r){const s=y.timezone.exec(r);s?(t.time=r.replace(s[1],""),t.timezone=s[1]):t.time=r}return t}function M(e,t){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=e.match(a);if(!r)return{year:NaN,restDateString:""};const s=r[1]?parseInt(r[1]):null,o=r[2]?parseInt(r[2]):null;return{year:o===null?s:o*100,restDateString:e.slice((r[1]||r[2]).length)}}function P(e,t){if(t===null)return new Date(NaN);const a=e.match(U);if(!a)return new Date(NaN);const r=!!a[4],s=N(a[1]),o=N(a[2])-1,f=N(a[3]),d=N(a[4]),u=N(a[5])-1;if(r)return W(t,d,u)?H(t,d,u):new Date(NaN);{const l=new Date(0);return!_(t,o,f)||!B(t,s)?new Date(NaN):(l.setUTCFullYear(t,o,Math.max(s,f)),l)}}function N(e){return e?parseInt(e):1}function z(e){const t=e.match(R);if(!t)return NaN;const a=j(t[1]),r=j(t[2]),s=j(t[3]);return v(a,r,s)?a*k+r*I+s*1e3:NaN}function j(e){return e&&parseFloat(e.replace(",","."))||0}function Y(e){if(e==="Z")return 0;const t=e.match($);if(!t)return 0;const a=t[1]==="+"?-1:1,r=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return V(r,s)?a*(r*k+s*I):NaN}function H(e,t,a){const r=new Date(0);r.setUTCFullYear(e,0,4);const s=r.getUTCDay()||7,o=(t-1)*7+a+1-s;return r.setUTCDate(r.getUTCDate()+o),r}const Z=[31,null,31,30,31,30,31,31,30,31,30,31];function E(e){return e%400===0||e%4===0&&e%100!==0}function _(e,t,a){return t>=0&&t<=11&&a>=1&&a<=(Z[t]||(E(e)?29:28))}function B(e,t){return t>=1&&t<=(E(e)?366:365)}function W(e,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function v(e,t,a){return e===24?t===0&&a===0:a>=0&&a<60&&t>=0&&t<60&&e>=0&&e<25}function V(e,t){return t>=0&&t<=59}const q=`
@keyframes blink {
  50% { opacity: 0.4; }
}
.estado-verde {
  background-color: #e9fcf0ff; 
  color: black;
  transition: all 0.4s ease;
}
.estado-naranja {
  background-color: #f97316;
  animation: blink 1s infinite;
  color: black;
}
.estado-rojo {
  background-color: #dc2626;
  animation: blink 1s infinite;
  color: white;
}
`;if(typeof document<"u"){const e=document.createElement("style");e.innerHTML=q,document.head.appendChild(e)}const b=e=>{if(!e)return"No reportado";try{const[t,a]=e.split(" "),[r,s,o]=t.split("-");return`${o}/${s}/${r}${a?" "+a:""}`}catch{return e}},G=e=>{const t="America/Mexico_City";let a;try{a=(void 0)(new Date,t)}catch{a=new Date}return e.CitaDelta&&h(e.CitaDelta),e.LlegadaDelta&&h(e.LlegadaDelta),e.SalidaDelta&&h(e.SalidaDelta),e.EntradaBascula&&h(e.EntradaBascula),e.SalidaBascula&&h(e.SalidaBascula),e.LlegadaAnden&&h(e.LlegadaAnden),e.SalidaAnden&&h(e.SalidaAnden),e.SalidaPlanta&&h(e.SalidaPlanta),e.InicioRuta&&h(e.InicioRuta),{colorCelda:{llegadaDelta:"",salidaDelta:"",entradaBascula:"",salidaBascula:"",llegadaAnden:"",salidaAnden:"",inicioRuta:"",salidaPlanta:""},colorFila:""}};function X(){var S;const[e,t]=x.useState(()=>new Date().toISOString().split("T")[0]),a=new Date().toISOString().split("T")[0],[r,s]=x.useState(a),[o,f]=x.useState(a),[d,u]=x.useState([]),[l,g]=x.useState(null),F=6e4;x.useEffect(()=>{D();const i=setInterval(D,F);return()=>clearInterval(i)},[e,r,o]),x.useEffect(()=>(T.private("monitor-logistico").listen("MovtoUpdated",c=>{u(m=>m.map(p=>p.ODP===c.ODP?{...p,...c}:p))}),()=>T.leave("monitor-logistico")),[]);const D=async()=>{var i;try{let c="/api/monitor/json";r&&o?c+=`?fecha_inicio=${r}&fecha_fin=${o}`:c+=`?fecha=${e||new Date().toISOString().split("T")[0]}`,console.log("Conectando con backend:",c);const m=await fetch(c);if(!m.ok)throw new Error(`Error HTTP ${m.status}`);const p=await m.json();console.log("Datos recibidos:",((i=p==null?void 0:p.data)==null?void 0:i.length)||0,"registros"),u((p==null?void 0:p.data)||[]),g(new Date().toLocaleTimeString("es-MX"))}catch(c){console.error("Error en la conexión o lectura de datos:",c),u([])}};return n.jsxs(n.Fragment,{children:[n.jsx(O,{title:"Almacen"}),n.jsxs("div",{className:"container mx-auto max-w-none p-2",children:[n.jsx("h1",{className:"text-3xl font-bold mb-4 text-center",children:"MONITOR DE ENTREGAS PASTEURIZADORA MAULEC SAPI DE CV"}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4 justify-center",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium",children:"Desde"}),n.jsx("input",{type:"date",value:r,onChange:i=>{s(i.target.value),t("")},className:"border rounded px-2 py-1"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium",children:"Hasta"}),n.jsx("input",{type:"date",value:o,onChange:i=>{f(i.target.value),t("")},className:"border rounded px-2 py-1"})]}),n.jsx("button",{onClick:D,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Filtrar"}),n.jsxs("div",{className:"text-sm text-gray-600 italic",children:["Última actualización: ",l||"---"]}),n.jsxs("form",{method:"POST",action:"/logout",onSubmit:()=>console.log("Cerrando sesión..."),children:[n.jsx("input",{type:"hidden",name:"_token",value:(S=document.querySelector('meta[name="csrf-token"]'))==null?void 0:S.getAttribute("content")}),n.jsx("button",{type:"submit",className:"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition",children:"Cerrar sesión"})]})]}),n.jsx("div",{className:"overflow-x-auto max-h-[85vh] shadow-md border border-gray-300 rounded-md",children:n.jsxs("table",{className:"table-auto w-full text-xs md:text-sm border-collapse",children:[n.jsx("thead",{className:"bg-gray-100 sticky top-0 z-10 shadow-sm",children:n.jsxs("tr",{children:[n.jsx("th",{className:"border px-2 py-2",children:"ODP"}),n.jsx("th",{className:"border px-2 py-2",children:"Línea Transporte"}),n.jsx("th",{className:"border px-2 py-2",children:"Cita Entrega"}),n.jsx("th",{className:"border px-2 py-2",children:"Salida Planta"}),n.jsx("th",{className:"border px-2 py-2",children:"Inicio Ruta"}),n.jsx("th",{className:"border px-2 py-2",children:"ETA"}),n.jsx("th",{className:"border px-2 py-2",children:"Status"}),n.jsx("th",{className:"border px-2 py-2",children:"Comentarios"})]})}),n.jsx("tbody",{children:d.length>0?d.filter(i=>{var c;return((c=i.Status)==null?void 0:c.toLowerCase())!=="entregado"}).map((i,c)=>{const{colorFila:m}=G(i);return n.jsxs("tr",{className:`text-center ${m}`,children:[n.jsx("td",{className:"border px-2 py-1",children:i.ODP||"No reportado"}),n.jsx("td",{className:"border px-2 py-1",children:i.LineaTransporte||"No reportado"}),n.jsx("td",{className:"border px-2 py-1",children:b(i.CitaEntrega)}),n.jsx("td",{className:"border px-2 py-1",children:b(i.SalidaPlanta)}),n.jsx("td",{className:"border px-2 py-1",children:b(i.InicioRuta)}),n.jsx("td",{className:"border px-2 py-1",children:b(i.ETA)}),n.jsx("td",{className:"border px-2 py-1",children:i.Status||"No reportado"}),n.jsx("td",{className:"border px-2 py-1",children:i.ComentarioTransito||"No reportado"})]},c)}):n.jsx("tr",{children:n.jsx("td",{colSpan:"11",className:"text-center py-3 text-gray-500",children:"No hay registros para la fecha seleccionada o rango"})})})]})})]}),n.jsx("footer",{className:"bg-gray-100 text-center py-4 mt-6 border-t shadow-inner",children:n.jsxs("p",{className:"text-gray-700 text-sm md:text-base tracking-wide",children:["© ",new Date().getFullYear()," Desarrollo y análisis de datos"]})})]})}export{X as default};
