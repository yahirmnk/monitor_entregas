import{r as x,e as w,j as r,H as $}from"./app-rMcohdqe.js";const S=6e4,F=36e5,A=Symbol.for("constructDateFrom");function k(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&A in e?e[A](t):e instanceof Date?new e.constructor(t):new Date(t)}function j(e,t){return k(e,e)}function v(e){return t=>{const n=(e?Math[e]:Math.trunc)(t);return n===0?0:n}}function O(e,t){return+j(e)-+j(t)}function C(e,t,a){const n=O(e,t)/S;return v(a==null?void 0:a.roundingMethod)(n)}function D(e,t){const a=()=>k(t==null?void 0:t.in,NaN),s=P(e);let c;if(s.date){const l=z(s.date,2);c=L(l.restDateString,l.year)}if(!c||isNaN(+c))return a();const f=+c;let i=0,h;if(s.time&&(i=Y(s.time),isNaN(i)))return a();if(s.timezone){if(h=H(s.timezone),isNaN(h))return a()}else{const l=new Date(f+i),p=j(0);return p.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),p.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),p}return j(f+i+h)}const y={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},U=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,E=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,R=/^([+-])(\d{2})(?::?(\d{2}))?$/;function P(e){const t={},a=e.split(y.dateTimeDelimiter);let n;if(a.length>2)return t;if(/:/.test(a[0])?n=a[0]:(t.date=a[0],n=a[1],y.timeZoneDelimiter.test(t.date)&&(t.date=e.split(y.timeZoneDelimiter)[0],n=e.substr(t.date.length,e.length))),n){const s=y.timezone.exec(n);s?(t.time=n.replace(s[1],""),t.timezone=s[1]):t.time=n}return t}function z(e,t){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(a);if(!n)return{year:NaN,restDateString:""};const s=n[1]?parseInt(n[1]):null,c=n[2]?parseInt(n[2]):null;return{year:c===null?s:c*100,restDateString:e.slice((n[1]||n[2]).length)}}function L(e,t){if(t===null)return new Date(NaN);const a=e.match(U);if(!a)return new Date(NaN);const n=!!a[4],s=b(a[1]),c=b(a[2])-1,f=b(a[3]),i=b(a[4]),h=b(a[5])-1;if(n)return J(t,i,h)?Z(t,i,h):new Date(NaN);{const l=new Date(0);return!B(t,c,f)||!W(t,s)?new Date(NaN):(l.setUTCFullYear(t,c,Math.max(s,f)),l)}}function b(e){return e?parseInt(e):1}function Y(e){const t=e.match(E);if(!t)return NaN;const a=T(t[1]),n=T(t[2]),s=T(t[3]);return V(a,n,s)?a*F+n*S+s*1e3:NaN}function T(e){return e&&parseFloat(e.replace(",","."))||0}function H(e){if(e==="Z")return 0;const t=e.match(R);if(!t)return 0;const a=t[1]==="+"?-1:1,n=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return X(n,s)?a*(n*F+s*S):NaN}function Z(e,t,a){const n=new Date(0);n.setUTCFullYear(e,0,4);const s=n.getUTCDay()||7,c=(t-1)*7+a+1-s;return n.setUTCDate(n.getUTCDate()+c),n}const _=[31,null,31,30,31,30,31,31,30,31,30,31];function M(e){return e%400===0||e%4===0&&e%100!==0}function B(e,t,a){return t>=0&&t<=11&&a>=1&&a<=(_[t]||(M(e)?29:28))}function W(e,t){return t>=1&&t<=(M(e)?366:365)}function J(e,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function V(e,t,a){return e===24?t===0&&a===0:a>=0&&a<60&&t>=0&&t<60&&e>=0&&e<25}function X(e,t){return t>=0&&t<=59}const q=`
@keyframes blink {
  50% { opacity: 0.4; }
}
.estado-verde {
  background-color: #16a34a;
  color: white;
  transition: all 0.4s ease;
}
.estado-naranja {
  background-color: #f97316;
  animation: blink 1s infinite;
  color: black;
}
.estado-rojo {
  background-color: #dc2626;
  animation: blink 1s infinite;
  color: white;
}
`;if(typeof document<"u"){const e=document.createElement("style");e.innerHTML=q,document.head.appendChild(e)}const N=e=>{if(!e)return"No reportado";try{const[t,a]=e.split(" "),[n,s,c]=t.split("-");return`${c}/${s}/${n}${a?" "+a:""}`}catch{return e}},G=e=>{const t="America/Mexico_City";let a;try{a=(void 0)(new Date,t)}catch{a=new Date}const n=e.CitaDelta?D(e.CitaDelta):null,s=e.LlegadaDelta?D(e.LlegadaDelta):null,c=e.EntradaBascula?D(e.EntradaBascula):null,f=e.LlegadaAnden?D(e.LlegadaAnden):null,i=e.InicioRuta?D(e.InicioRuta):null,h=e.SalidaPlanta?D(e.SalidaPlanta):null,l={llegadaDelta:"",llegadaAnden:"",salidaPlanta:""};let p="";if(n&&!s){const d=C(a,n);d>=-60&&d<0?l.llegadaDelta="estado-naranja":d>=0&&(l.llegadaDelta="estado-rojo")}else s&&(l.llegadaDelta="estado-verde");if(c&&!f){const d=C(a,c);d<20?l.llegadaAnden="estado-naranja":d>=20&&(l.llegadaAnden="estado-rojo")}else f&&(l.llegadaAnden="estado-verde");if(i&&!h){const d=C(a,i);d>=-60&&d<120&&(l.salidaPlanta="estado-naranja"),d>=120&&(p="estado-rojo")}return{colorCelda:l,colorFila:p}};function Q(){const[e,t]=x.useState(()=>new Date().toISOString().split("T")[0]),[a,n]=x.useState(""),[s,c]=x.useState(""),[f,i]=x.useState([]),[h,l]=x.useState(null),p=6e4;x.useEffect(()=>{console.log("Componente montado. Fecha actual:",e),d();const o=setInterval(()=>{console.log("Actualización automática cada minuto..."),d()},p);return()=>{console.log("Desmontando componente, limpiando intervalos."),clearInterval(o)}},[e,a,s]),x.useEffect(()=>(console.log("Escuchando canal privado: monitor-logistico"),w.private("monitor-logistico").listen("MovtoUpdated",m=>{console.log("Evento recibido desde servidor:",m),i(u=>u.map(g=>g.ODP===m.ODP?{...g,...m}:g))}),()=>{w.leave("monitor-logistico"),console.log("Canal cerrado: monitor-logistico")}),[]);const d=async()=>{try{let o="/api/monitor/json";if(a&&s)o+=`?fecha_inicio=${a}&fecha_fin=${s}`,console.log("Consultando rango de fechas:",a,"a",s);else if(e)o+=`?fecha=${e}`,console.log("Consultando fecha única:",e);else{const I=new Date().toISOString().split("T")[0];o+=`?fecha=${I}`,console.log("Sin selección, usando fecha actual:",I)}console.log("Solicitud enviada a:",o);const m=await fetch(o);if(!m.ok)throw new Error(`Error HTTP ${m.status}`);const u=await m.json();console.log("Respuesta recibida:",u),u&&Array.isArray(u.data)?(i(u.data),console.log("Total de registros:",u.data.length)):(console.warn("Formato inesperado:",u),i([]));const g=new Date().toLocaleTimeString("es-MX");l(g),console.log("Actualización completada a las:",g)}catch(o){console.error("Error al obtener datos:",o),i([])}};return r.jsxs(r.Fragment,{children:[r.jsx($,{title:"Almacen"}),r.jsxs("div",{className:"container mx-auto p-4",children:[r.jsx("h1",{className:"text-2xl font-bold mb-4",children:"MONITOR TRÁFICO"}),r.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Fecha única"}),r.jsx("input",{type:"date",value:e,onChange:o=>{console.log("Cambio de fecha única:",o.target.value),t(o.target.value),n(""),c("")},className:"border rounded px-2 py-1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Desde"}),r.jsx("input",{type:"date",value:a,onChange:o=>{console.log("Cambio de fecha inicio:",o.target.value),n(o.target.value),t("")},className:"border rounded px-2 py-1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Hasta"}),r.jsx("input",{type:"date",value:s,onChange:o=>{console.log("Cambio de fecha fin:",o.target.value),c(o.target.value),t("")},className:"border rounded px-2 py-1"})]}),r.jsx("button",{onClick:()=>{console.log("Cargando fechas del filtro de rango de fecha"),d()},className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition",children:"Filtrar"}),r.jsxs("div",{className:"text-sm text-gray-600 italic",children:["Última actualización: ",h||"---"]})]}),r.jsxs("table",{className:"min-w-full border border-gray-300 text-sm",children:[r.jsx("thead",{className:"bg-gray-100",children:r.jsxs("tr",{children:[r.jsx("th",{className:"border px-2 py-1",children:"ODP"}),r.jsx("th",{className:"border px-2 py-1",children:"Cita Delta"}),r.jsx("th",{className:"border px-2 py-1",children:"Llegada Delta"}),r.jsx("th",{className:"border px-2 py-1",children:"Salida Delta"}),r.jsx("th",{className:"border px-2 py-1",children:"Entrada Báscula"}),r.jsx("th",{className:"border px-2 py-1",children:"No. Andén"}),r.jsx("th",{className:"border px-2 py-1",children:"Llegada Andén"}),r.jsx("th",{className:"border px-2 py-1",children:"Salida Planta"}),r.jsx("th",{className:"border px-2 py-1",children:"Inicio Ruta"})]})}),r.jsx("tbody",{children:f.length>0?f.filter(o=>!o.SalidaPlanta).map((o,m)=>{const{colorCelda:u,colorFila:g}=G(o);return r.jsxs("tr",{className:`text-center ${g}`,children:[r.jsx("td",{className:"border px-2 py-1",children:o.ODP||"No reportado"}),r.jsx("td",{className:"border px-2 py-1",children:N(o.CitaDelta)}),r.jsx("td",{className:`border px-2 py-1 ${u.llegadaDelta}`,children:N(o.LlegadaDelta)}),r.jsx("td",{className:"border px-2 py-1",children:N(o.SalidaDelta)}),r.jsx("td",{className:"border px-2 py-1",children:N(o.EntradaBascula)}),r.jsx("td",{className:"border px-2 py-1",children:o.NoAnden||"No reportado"}),r.jsx("td",{className:`border px-2 py-1 ${u.llegadaAnden}`,children:N(o.LlegadaAnden)}),r.jsx("td",{className:`border px-2 py-1 ${u.salidaPlanta}`,children:N(o.SalidaPlanta)}),r.jsx("td",{className:"border px-2 py-1",children:N(o.InicioRuta)})]},m)}):r.jsx("tr",{children:r.jsx("td",{colSpan:"9",className:"text-center py-3 text-gray-500",children:"No hay registros para la fecha seleccionada o rango"})})})]})]})]})}export{Q as default};
