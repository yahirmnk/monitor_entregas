import{r as m,e as b,j as r,H as A}from"./app-D84HLu9c.js";const j=6e4,C=36e5,T=Symbol.for("constructDateFrom");function I(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&T in e?e[T](t):e instanceof Date?new e.constructor(t):new Date(t)}function D(e,t){return I(e,e)}function w(e){return t=>{const n=(e?Math[e]:Math.trunc)(t);return n===0?0:n}}function M(e,t){return+D(e)-+D(t)}function N(e,t,a){const n=M(e,t)/j;return w(a==null?void 0:a.roundingMethod)(n)}function h(e,t){const a=()=>I(t==null?void 0:t.in,NaN),s=R(e);let c;if(s.date){const i=k(s.date,2);c=$(i.restDateString,i.year)}if(!c||isNaN(+c))return a();const f=+c;let u=0,l;if(s.time&&(u=L(s.time),isNaN(u)))return a();if(s.timezone){if(l=P(s.timezone),isNaN(l))return a()}else{const i=new Date(f+u),o=D(0);return o.setFullYear(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()),o.setHours(i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds()),o}return D(f+u+l)}const g={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},U=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,O=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,F=/^([+-])(\d{2})(?::?(\d{2}))?$/;function R(e){const t={},a=e.split(g.dateTimeDelimiter);let n;if(a.length>2)return t;if(/:/.test(a[0])?n=a[0]:(t.date=a[0],n=a[1],g.timeZoneDelimiter.test(t.date)&&(t.date=e.split(g.timeZoneDelimiter)[0],n=e.substr(t.date.length,e.length))),n){const s=g.timezone.exec(n);s?(t.time=n.replace(s[1],""),t.timezone=s[1]):t.time=n}return t}function k(e,t){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(a);if(!n)return{year:NaN,restDateString:""};const s=n[1]?parseInt(n[1]):null,c=n[2]?parseInt(n[2]):null;return{year:c===null?s:c*100,restDateString:e.slice((n[1]||n[2]).length)}}function $(e,t){if(t===null)return new Date(NaN);const a=e.match(U);if(!a)return new Date(NaN);const n=!!a[4],s=x(a[1]),c=x(a[2])-1,f=x(a[3]),u=x(a[4]),l=x(a[5])-1;if(n)return H(t,u,l)?z(t,u,l):new Date(NaN);{const i=new Date(0);return!Y(t,c,f)||!Z(t,s)?new Date(NaN):(i.setUTCFullYear(t,c,Math.max(s,f)),i)}}function x(e){return e?parseInt(e):1}function L(e){const t=e.match(O);if(!t)return NaN;const a=y(t[1]),n=y(t[2]),s=y(t[3]);return B(a,n,s)?a*C+n*j+s*1e3:NaN}function y(e){return e&&parseFloat(e.replace(",","."))||0}function P(e){if(e==="Z")return 0;const t=e.match(F);if(!t)return 0;const a=t[1]==="+"?-1:1,n=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return W(n,s)?a*(n*C+s*j):NaN}function z(e,t,a){const n=new Date(0);n.setUTCFullYear(e,0,4);const s=n.getUTCDay()||7,c=(t-1)*7+a+1-s;return n.setUTCDate(n.getUTCDate()+c),n}const E=[31,null,31,30,31,30,31,31,30,31,30,31];function S(e){return e%400===0||e%4===0&&e%100!==0}function Y(e,t,a){return t>=0&&t<=11&&a>=1&&a<=(E[t]||(S(e)?29:28))}function Z(e,t){return t>=1&&t<=(S(e)?366:365)}function H(e,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function B(e,t,a){return e===24?t===0&&a===0:a>=0&&a<60&&t>=0&&t<60&&e>=0&&e<25}function W(e,t){return t>=0&&t<=59}const _=`
@keyframes blink {
  50% { opacity: 0.4; }
}
.estado-verde {
  background-color: #16a34a;
  color: white;
  transition: all 0.4s ease;
}
.estado-naranja {
  background-color: #f97316;
  animation: blink 1s infinite;
  color: black;
}
.estado-rojo {
  background-color: #dc2626;
  animation: blink 1s infinite;
  color: white;
}
`;if(typeof document<"u"){const e=document.createElement("style");e.innerHTML=_,document.head.appendChild(e)}const p=e=>{if(!e)return"No reportado";try{const[t,a]=e.split(" "),[n,s,c]=t.split("-");return`${c}/${s}/${n}${a?" "+a:""}`}catch{return e}},v=e=>{const t="America/Mexico_City";let a;try{a=(void 0)(new Date,t)}catch{a=new Date}const n=e.CitaDelta?h(e.CitaDelta):null,s=e.LlegadaDelta?h(e.LlegadaDelta):null,c=e.EntradaBascula?h(e.EntradaBascula):null,f=e.LlegadaAnden?h(e.LlegadaAnden):null,u=e.InicioRuta?h(e.InicioRuta):null,l=e.SalidaPlanta?h(e.SalidaPlanta):null,i={llegadaDelta:"",llegadaAnden:"",salidaPlanta:""};let o="";if(n&&!s){const d=N(a,n);d>=-60&&d<0?i.llegadaDelta="estado-naranja":d>=0&&(i.llegadaDelta="estado-rojo")}else s&&(i.llegadaDelta="estado-verde");if(c&&!f){const d=N(a,c);d<20?i.llegadaAnden="estado-naranja":d>=20&&(i.llegadaAnden="estado-rojo")}else f&&(i.llegadaAnden="estado-verde");if(u&&!l){const d=N(a,u);d>=-60&&d<60&&(i.salidaPlanta="estado-naranja"),d>=60&&(o="estado-rojo")}return{colorCelda:i,colorFila:o}};function V(){const[e,t]=m.useState(()=>new Date().toISOString().split("T")[0]),[a,n]=m.useState([]),[s,c]=m.useState(null),f=6e4;m.useEffect(()=>{u(e);const l=setInterval(()=>u(e),f);return()=>clearInterval(l)},[e]),m.useEffect(()=>(b.private("monitor-logistico").listen("MovtoUpdated",i=>{n(o=>o.map(d=>d.ODP===i.ODP?{...d,...i}:d))}),()=>b.leave("monitor-logistico")),[]);const u=async l=>{try{const o=await(await fetch(`/api/monitor/json?fecha=${l}`)).json();o&&Array.isArray(o.data)&&n(o.data),c(new Date().toLocaleTimeString("es-MX"))}catch{n([])}};return r.jsxs(r.Fragment,{children:[r.jsx(A,{title:"Almacen"}),r.jsxs("div",{className:"container mx-auto p-4",children:[r.jsx("h1",{className:"text-2xl font-bold mb-4",children:"MONITOR TRÁFICO"}),r.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Fecha"}),r.jsx("input",{type:"date",value:e,onChange:l=>t(l.target.value),className:"border rounded px-2 py-1"})]}),r.jsxs("div",{className:"text-sm text-gray-600 italic",children:["Última actualización: ",s||"---"]})]}),r.jsxs("table",{className:"min-w-full border border-gray-300 text-sm",children:[r.jsx("thead",{className:"bg-gray-100",children:r.jsxs("tr",{children:[r.jsx("th",{className:"border px-2 py-1",children:"ODP"}),r.jsx("th",{className:"border px-2 py-1",children:"Cita Delta"}),r.jsx("th",{className:"border px-2 py-1",children:"Llegada Delta"}),r.jsx("th",{className:"border px-2 py-1",children:"Salida Delta"}),r.jsx("th",{className:"border px-2 py-1",children:"Entrada Báscula"}),r.jsx("th",{className:"border px-2 py-1",children:"No. Andén"}),r.jsx("th",{className:"border px-2 py-1",children:"Llegada Andén"}),r.jsx("th",{className:"border px-2 py-1",children:"Salida Planta"}),r.jsx("th",{className:"border px-2 py-1",children:"Inicio Ruta"})]})}),r.jsx("tbody",{children:a.length>0?a.filter(l=>!l.SalidaPlanta).map((l,i)=>{const{colorCelda:o,colorFila:d}=v(l);return r.jsxs("tr",{className:`text-center ${d}`,children:[r.jsx("td",{className:"border px-2 py-1",children:l.ODP||"No reportado"}),r.jsx("td",{className:"border px-2 py-1",children:p(l.CitaDelta)}),r.jsx("td",{className:`border px-2 py-1 ${o.llegadaDelta}`,children:p(l.LlegadaDelta)}),r.jsx("td",{className:"border px-2 py-1",children:p(l.SalidaDelta)}),r.jsx("td",{className:"border px-2 py-1",children:p(l.EntradaBascula)}),r.jsx("td",{className:"border px-2 py-1",children:l.NoAnden||"No reportado"}),r.jsx("td",{className:`border px-2 py-1 ${o.llegadaAnden}`,children:p(l.LlegadaAnden)}),r.jsx("td",{className:`border px-2 py-1 ${o.salidaPlanta}`,children:p(l.SalidaPlanta)}),r.jsx("td",{className:"border px-2 py-1",children:p(l.InicioRuta)})]},i)}):r.jsx("tr",{children:r.jsx("td",{colSpan:"9",className:"text-center py-3 text-gray-500",children:"No hay registros para la fecha seleccionada"})})})]})]})]})}export{V as default};
