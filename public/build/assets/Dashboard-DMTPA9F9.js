import{r as D,e as I,j as n,H as F}from"./app-FUn-3EKF.js";const C=6e4,w=36e5,A=Symbol.for("constructDateFrom");function $(e,a){return typeof e=="function"?e(a):e&&typeof e=="object"&&A in e?e[A](a):e instanceof Date?new e.constructor(a):new Date(a)}function S(e,a){return $(e,e)}function B(e){return a=>{const s=(e?Math[e]:Math.trunc)(a);return s===0?0:s}}function M(e,a){return+S(e)-+S(a)}function j(e,a,t){const s=M(e,a)/C;return B(t==null?void 0:t.roundingMethod)(s)}function x(e,a){const t=()=>$(a==null?void 0:a.in,NaN),l=E(e);let c;if(l.date){const o=L(l.date,2);c=P(o.restDateString,o.year)}if(!c||isNaN(+c))return t();const f=+c;let u=0,p;if(l.time&&(u=z(l.time),isNaN(u)))return t();if(l.timezone){if(p=Y(l.timezone),isNaN(p))return t()}else{const o=new Date(f+u),g=S(0);return g.setFullYear(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),g.setHours(o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds()),g}return S(f+u+p)}const y={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},R=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,O=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,U=/^([+-])(\d{2})(?::?(\d{2}))?$/;function E(e){const a={},t=e.split(y.dateTimeDelimiter);let s;if(t.length>2)return a;if(/:/.test(t[0])?s=t[0]:(a.date=t[0],s=t[1],y.timeZoneDelimiter.test(a.date)&&(a.date=e.split(y.timeZoneDelimiter)[0],s=e.substr(a.date.length,e.length))),s){const l=y.timezone.exec(s);l?(a.time=s.replace(l[1],""),a.timezone=l[1]):a.time=s}return a}function L(e,a){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+a)+"})|(\\d{2}|[+-]\\d{"+(2+a)+"})$)"),s=e.match(t);if(!s)return{year:NaN,restDateString:""};const l=s[1]?parseInt(s[1]):null,c=s[2]?parseInt(s[2]):null;return{year:c===null?l:c*100,restDateString:e.slice((s[1]||s[2]).length)}}function P(e,a){if(a===null)return new Date(NaN);const t=e.match(R);if(!t)return new Date(NaN);const s=!!t[4],l=b(t[1]),c=b(t[2])-1,f=b(t[3]),u=b(t[4]),p=b(t[5])-1;if(s)return W(a,u,p)?v(a,u,p):new Date(NaN);{const o=new Date(0);return!Z(a,c,f)||!_(a,l)?new Date(NaN):(o.setUTCFullYear(a,c,Math.max(l,f)),o)}}function b(e){return e?parseInt(e):1}function z(e){const a=e.match(O);if(!a)return NaN;const t=T(a[1]),s=T(a[2]),l=T(a[3]);return J(t,s,l)?t*w+s*C+l*1e3:NaN}function T(e){return e&&parseFloat(e.replace(",","."))||0}function Y(e){if(e==="Z")return 0;const a=e.match(U);if(!a)return 0;const t=a[1]==="+"?-1:1,s=parseInt(a[2]),l=a[3]&&parseInt(a[3])||0;return V(s,l)?t*(s*w+l*C):NaN}function v(e,a,t){const s=new Date(0);s.setUTCFullYear(e,0,4);const l=s.getUTCDay()||7,c=(a-1)*7+t+1-l;return s.setUTCDate(s.getUTCDate()+c),s}const H=[31,null,31,30,31,30,31,31,30,31,30,31];function k(e){return e%400===0||e%4===0&&e%100!==0}function Z(e,a,t){return a>=0&&a<=11&&t>=1&&t<=(H[a]||(k(e)?29:28))}function _(e,a){return a>=1&&a<=(k(e)?366:365)}function W(e,a,t){return a>=1&&a<=53&&t>=0&&t<=6}function J(e,a,t){return e===24?a===0&&t===0:t>=0&&t<60&&a>=0&&a<60&&e>=0&&e<25}function V(e,a){return a>=0&&a<=59}const X=`
@keyframes blink {
  50% { opacity: 0.4; }
}
.estado-verde {
  background-color: #e9fcf0ff; 
  color: black;
  transition: all 0.4s ease;
}
.estado-naranja {
  background-color: #f97316;
  animation: blink 1s infinite;
  color: black;
}
.estado-rojo {
  background-color: #dc2626;
  animation: blink 1s infinite;
  color: white;
}
`;if(typeof document<"u"){const e=document.createElement("style");e.innerHTML=X,document.head.appendChild(e)}const m=e=>{if(!e)return"No reportado";try{const[a,t]=e.split(" "),[s,l,c]=a.split("-");return`${c}/${l}/${s}${t?" "+t:""}`}catch{return e}},q=e=>{const a="America/Mexico_City";let t;try{t=(void 0)(new Date,a)}catch{t=new Date}const s=e.CitaDelta?x(e.CitaDelta):null,l=e.LlegadaDelta?x(e.LlegadaDelta):null,c=e.SalidaDelta?x(e.SalidaDelta):null,f=e.EntradaBascula?x(e.EntradaBascula):null,u=e.SalidaBascula?x(e.SalidaBascula):null,p=e.LlegadaAnden?x(e.LlegadaAnden):null,o=e.SalidaAnden?x(e.SalidaAnden):null,g=e.SalidaPlanta?x(e.SalidaPlanta):null,N=e.InicioRuta?x(e.InicioRuta):null,r={llegadaDelta:"",salidaDelta:"",entradaBascula:"",salidaBascula:"",llegadaAnden:"",salidaAnden:"",inicioRuta:"",salidaPlanta:""};let d="";if(s&&!l){const i=j(s,t);i<=120&&i>60?r.llegadaDelta="estado-naranja":i<=60&&i>=0&&(r.llegadaDelta="estado-rojo")}else l&&(r.llegadaDelta="estado-verde");if(l&&!c){const i=j(t,l);i>=120&&i<180?r.salidaDelta="estado-naranja":i>=180&&(r.salidaDelta="estado-rojo")}else c&&(r.salidaDelta="estado-verde");if(c&&!f){const i=j(t,c);i>=10&&i<20?r.entradaBascula="estado-naranja":i>=20&&(r.entradaBascula="estado-rojo")}else f&&(r.entradaBascula="estado-verde");if(f&&!u?j(t,f)>=10&&(r.salidaBascula="estado-rojo"):u&&(r.salidaBascula="estado-verde"),p&&!o?j(t,p)>=60&&(r.salidaAnden="estado-rojo"):o&&(r.salidaAnden="estado-verde"),g&&!N){const i=j(t,g);i>=0&&i<60?d="estado-naranja":i>=60&&(d="estado-rojo")}else N&&(r.inicioRuta="estado-verde");return{colorCelda:r,colorFila:d}};function K(){const[e,a]=D.useState(()=>new Date().toISOString().split("T")[0]),[t,s]=D.useState(""),[l,c]=D.useState(""),[f,u]=D.useState([]),[p,o]=D.useState(null),g=6e4;D.useEffect(()=>{N();const r=setInterval(N,g);return()=>clearInterval(r)},[e,t,l]),D.useEffect(()=>(I.private("monitor-logistico").listen("MovtoUpdated",d=>{u(i=>i.map(h=>h.ODP===d.ODP?{...h,...d}:h))}),()=>I.leave("monitor-logistico")),[]);const N=async()=>{var r;try{let d="/api/monitor/json";t&&l?d+=`?fecha_inicio=${t}&fecha_fin=${l}`:d+=`?fecha=${e||new Date().toISOString().split("T")[0]}`,console.log("Conectando con backend:",d);const i=await fetch(d);if(!i.ok)throw new Error(`Error HTTP ${i.status}`);const h=await i.json();console.log("Datos recibidos:",((r=h==null?void 0:h.data)==null?void 0:r.length)||0,"registros"),u((h==null?void 0:h.data)||[]),o(new Date().toLocaleTimeString("es-MX"))}catch(d){console.error("Error en la conexión o lectura de datos:",d),u([])}};return n.jsxs(n.Fragment,{children:[n.jsx(F,{title:"Almacen"}),n.jsxs("div",{className:"container mx-auto p-4",children:[n.jsx("h1",{className:"text-2xl font-bold mb-4",children:"MONITOR TRÁFICO"}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium",children:"Fecha única"}),n.jsx("input",{type:"date",value:e,onChange:r=>{a(r.target.value),s(""),c("")},className:"border rounded px-2 py-1"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium",children:"Desde"}),n.jsx("input",{type:"date",value:t,onChange:r=>{s(r.target.value),a("")},className:"border rounded px-2 py-1"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium",children:"Hasta"}),n.jsx("input",{type:"date",value:l,onChange:r=>{c(r.target.value),a("")},className:"border rounded px-2 py-1"})]}),n.jsx("button",{onClick:N,className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition",children:"Filtrar"}),n.jsxs("div",{className:"text-sm text-gray-600 italic",children:["Última actualización: ",p||"---"]})]}),n.jsxs("table",{className:"min-w-full border border-gray-300 text-sm",children:[n.jsx("thead",{className:"bg-gray-100",children:n.jsxs("tr",{children:[n.jsx("th",{className:"border px-2 py-1",children:"ODP"}),n.jsx("th",{className:"border px-2 py-1",children:"Cita Delta"}),n.jsx("th",{className:"border px-2 py-1",children:"Llegada Delta"}),n.jsx("th",{className:"border px-2 py-1",children:"Salida Delta"}),n.jsx("th",{className:"border px-2 py-1",children:"Entrada Báscula"}),n.jsx("th",{className:"border px-2 py-1",children:"Salida Báscula"}),n.jsx("th",{className:"border px-2 py-1",children:"No. Andén"}),n.jsx("th",{className:"border px-2 py-1",children:"Llegada Andén"}),n.jsx("th",{className:"border px-2 py-1",children:"Salida Andén"}),n.jsx("th",{className:"border px-2 py-1",children:"Salida Planta"}),n.jsx("th",{className:"border px-2 py-1",children:"Inicio Ruta"})]})}),n.jsx("tbody",{children:f.length>0?f.map((r,d)=>{const{colorCelda:i,colorFila:h}=q(r);return n.jsxs("tr",{className:`text-center ${h}`,children:[n.jsx("td",{className:"border px-2 py-1",children:r.ODP||"No reportado"}),n.jsx("td",{className:"border px-2 py-1",children:m(r.CitaDelta)}),n.jsx("td",{className:`border px-2 py-1 ${i.llegadaDelta}`,children:m(r.LlegadaDelta)}),n.jsx("td",{className:`border px-2 py-1 ${i.salidaDelta}`,children:m(r.SalidaDelta)}),n.jsx("td",{className:`border px-2 py-1 ${i.entradaBascula}`,children:m(r.EntradaBascula)}),n.jsx("td",{className:`border px-2 py-1 ${i.salidaBascula}`,children:m(r.SalidaBascula)}),n.jsx("td",{className:"border px-2 py-1",children:r.NoAnden||"No reportado"}),n.jsx("td",{className:`border px-2 py-1 ${i.llegadaAnden}`,children:m(r.LlegadaAnden)}),n.jsx("td",{className:`border px-2 py-1 ${i.salidaAnden}`,children:m(r.SalidaAnden)}),n.jsx("td",{className:`border px-2 py-1 ${i.salidaPlanta}`,children:m(r.SalidaPlanta)}),n.jsx("td",{className:`border px-2 py-1 ${i.inicioRuta}`,children:m(r.InicioRuta)})]},d)}):n.jsx("tr",{children:n.jsx("td",{colSpan:"11",className:"text-center py-3 text-gray-500",children:"No hay registros para la fecha seleccionada o rango"})})})]})]})]})}export{K as default};
